# CapiBobbaBot - Documentaci√≥n del Proyecto

## üìã Descripci√≥n General

CapiBobbaBot es un sistema completo de automatizaci√≥n para una tienda de bubble tea que incluye:
- Bot de WhatsApp con IA (Google Gemini)
- Sistema de monitoreo en tiempo real
- Dashboard administrativo
- Integraci√≥n con n8n para automatizaci√≥n de procesos
- Persistencia con Redis

## üèóÔ∏è Arquitectura del Sistema

### Componentes Principales

1. **Chatbot Principal** (`chatbot.js`)
   - Servidor Express para manejar webhooks de WhatsApp
   - Integraci√≥n con Google Gemini para respuestas inteligentes
   - Gesti√≥n de estado de conversaciones con Redis
   - Sistema de m√©tricas y monitoreo

2. **Sistema de Monitoreo** (`/monitoring/`)
   - Recolecci√≥n de m√©tricas en tiempo real
   - Health checks autom√°ticos
   - Servidor WebSocket para comunicaci√≥n en tiempo real
   - Monitor de memoria y recursos

3. **Dashboard Web** (`/dashboard/`)
   - React SPA con dise√±o moderno y tema oscuro
   - Editor de configuraci√≥n del negocio
   - Visualizaci√≥n de pedidos y logs
   - Panel de monitoreo en tiempo real
   - UI mejorada con tarjetas, iconos FontAwesome y efectos hover
   - Layout responsive con grid de 2 columnas

4. **Integraci√≥n n8n**
   - Workflows para procesamiento de mensajes
   - Automatizaci√≥n de pedidos
   - Gesti√≥n de clientes en Google Sheets
   - Notificaciones y alertas

## üìÇ Estructura de Archivos

```
CapiBobbaBot/
‚îú‚îÄ‚îÄ chatbot.js              # Servidor principal del bot
‚îú‚îÄ‚îÄ business_data.js        # Configuraci√≥n del negocio (men√∫, promos)
‚îú‚îÄ‚îÄ package.json            # Dependencias Node.js
‚îú‚îÄ‚îÄ .env                    # Variables de entorno (NO INCLUIR EN GIT)
‚îú‚îÄ‚îÄ .env.example           # Plantilla de variables de entorno
‚îú‚îÄ‚îÄ README.md              # Documentaci√≥n
‚îú‚îÄ‚îÄ PRIVACY_POLICY.md      # Pol√≠tica de privacidad
‚îÇ
‚îú‚îÄ‚îÄ monitoring/            # Sistema de monitoreo
‚îÇ   ‚îú‚îÄ‚îÄ metrics.js         # Recolector de m√©tricas
‚îÇ   ‚îú‚îÄ‚îÄ health-checker.js  # Health checks
‚îÇ   ‚îú‚îÄ‚îÄ websocket-server.js # Servidor WebSocket
‚îÇ   ‚îî‚îÄ‚îÄ memory-monitor.js  # Monitor de memoria
‚îÇ
‚îú‚îÄ‚îÄ dashboard/             # Frontend del dashboard
‚îÇ   ‚îú‚îÄ‚îÄ build/            # Build de producci√≥n (React)
‚îÇ   ‚îú‚îÄ‚îÄ src/              # C√≥digo fuente React
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ App.js        # Componente principal con nuevo dise√±o
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.css     # Estilos modernos con tema oscuro
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [componentes] # Componentes individuales
‚îÇ   ‚îú‚îÄ‚îÄ public/           # Archivos p√∫blicos
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.html    # HTML principal con FontAwesome
‚îÇ   ‚îú‚îÄ‚îÄ css/              # Estilos del panel de monitoreo
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ monitoring.css
‚îÇ   ‚îú‚îÄ‚îÄ js/               # Scripts del cliente
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ monitoring-client.js
‚îÇ   ‚îî‚îÄ‚îÄ monitoring.html   # Panel de monitoreo independiente
‚îÇ
‚îî‚îÄ‚îÄ [Workflows n8n]/      # Archivos JSON de workflows
    ‚îú‚îÄ‚îÄ CapiBobba Enhanced - Complete Message Processor (ACTIVE).json
    ‚îî‚îÄ‚îÄ [otros workflows]
```

## üîß Variables de Entorno

### Variables Obligatorias

```env
# API de WhatsApp (Meta)
VERIFY_TOKEN="token_secreto_verificacion"
WHATSAPP_TOKEN="token_permanente_acceso"
PHONE_NUMBER_ID="id_numero_telefono"

# API de Google Gemini
GEMINI_API_KEY="clave_api_gemini"

# Administradores
ADMIN_WHATSAPP_NUMBERS="521XXXXXXXXXX,521YYYYYYYYYY"

# n8n Webhook
N8N_WEBHOOK_URL="https://n8n-instance.com/webhook/id"

# Redis
REDIS_URL="redis://user:password@host:port"
```

### Variables Opcionales

```env
# Configuraci√≥n del servidor
PORT=3000
WEBSOCKET_PORT=3001
BASE_URL="https://tu-bot.render.com"

# API de WhatsApp
WHATSAPP_API_VERSION="v18.0"

# Notificaciones Telegram
TELEGRAM_BOT_TOKEN="token_bot_telegram"
TELEGRAM_CHAT_ID="id_chat"

# Umbrales de alertas
CPU_THRESHOLD=80
MEMORY_THRESHOLD=85
RESPONSE_TIME_THRESHOLD=5000
ERROR_RATE_THRESHOLD=0.05
DISK_THRESHOLD=90

# Intervalos
HEALTH_CHECK_INTERVAL=30000
METRICS_BROADCAST_INTERVAL=5000
METRICS_RETENTION_HOURS=24

# Backups
ENABLE_AUTO_BACKUP=true
BACKUP_SCHEDULE="0 3 * * *"
CLEANUP_SCHEDULE="0 2 * * 0"

# Desarrollo
NODE_ENV=production
LOG_LEVEL=info
WEBSOCKET_DEBUG=false
METRICS_DEBUG=false
```

## üöÄ Stack Tecnol√≥gico

### Backend
- **Node.js**: Runtime
- **Express.js**: Framework web
- **Redis**: Base de datos en memoria para estado
- **Axios**: Cliente HTTP
- **Body-parser**: Parsing de JSON
- **node-cron**: Tareas programadas
- **ws**: WebSocket para monitoreo

### Frontend
- **React**: Framework UI
- **Material-UI**: Componentes UI (en componentes espec√≠ficos)
- **CSS Variables**: Sistema de dise√±o con tema oscuro
- **FontAwesome**: Iconograf√≠a moderna
- **Chart.js**: Gr√°ficos
- **Socket.io-client**: Cliente WebSocket

### APIs Externas
- **WhatsApp Cloud API**: Mensajer√≠a
- **Google Gemini API**: Inteligencia Artificial
- **n8n**: Automatizaci√≥n de workflows

### Infraestructura
- **Render.com**: Hosting y deployment
- **Redis Cloud**: Base de datos Redis
- **n8n Cloud/Self-hosted**: Automatizaci√≥n

## üîÑ Flujo de Datos

### 1. Recepci√≥n de Mensajes
```
WhatsApp ‚Üí Webhook (/webhook POST) ‚Üí chatbot.js ‚Üí Redis (estado)
                                                 ‚Üí Gemini (IA)
                                                 ‚Üí n8n (an√°lisis)
```

### 2. Procesamiento en n8n
```
Webhook ‚Üí Message Normalizer ‚Üí Enhanced Processor ‚Üí Actions:
                                                    - Google Sheets
                                                    - Drive (im√°genes)
                                                    - Respuestas autom√°ticas
```

### 3. Monitoreo
```
M√©tricas ‚Üí MetricsCollector ‚Üí Redis ‚Üí WebSocket ‚Üí Dashboard
Health ‚Üí HealthChecker ‚Üí Alertas ‚Üí Telegram/Admin
```

## üìä Sistema de M√©tricas

### M√©tricas del Sistema
- **CPU**: Uso actual y hist√≥rico
- **Memoria**: RAM utilizada/disponible
- **Disco**: Espacio usado
- **Red**: Throughput de mensajes

### M√©tricas de Negocio
- **Pedidos**: Conteo por hora/d√≠a
- **Ingresos**: Tracking de ventas
- **Conversi√≥n**: Ratio mensajes/pedidos
- **Tiempo de respuesta**: Latencia promedio

### M√©tricas de Rendimiento
- **Response Time**: Tiempo de respuesta del bot
- **Error Rate**: Tasa de errores
- **Throughput**: Mensajes por segundo
- **Success Rate**: Tasa de √©xito

## üõ°Ô∏è Gesti√≥n de Estado

### Estados de Conversaci√≥n (Redis)
```javascript
{
  step: 'esperando_direccion' | 'esperando_metodo_pago' | etc,
  orderData: {
    summary: string,
    total: number,
    fullText: string
  },
  deliveryInfo: {
    address: string,
    accessCodeRequired: boolean
  },
  paymentInfo: {
    method: 'Efectivo' | 'Transferencia',
    cashDenomination?: number,
    proofImageId?: string
  }
}
```

### Claves en Redis
- `${phoneNumber}`: Estado de conversaci√≥n del usuario
- `maintenance_mode_status`: Estado de mantenimiento
- `metrics:*`: M√©tricas del sistema
- `orders:*`: Log de pedidos

## üîå Endpoints de la API

### Webhook de WhatsApp
- `GET /webhook`: Verificaci√≥n (una vez)
- `POST /webhook`: Recepci√≥n de mensajes

### Dashboard
- `GET /dashboard`: Panel administrativo
- `GET /monitoring`: Panel de monitoreo
- `GET /api/business-data`: Obtener configuraci√≥n
- `POST /api/business-data`: Actualizar configuraci√≥n
- `GET /api/orders`: Obtener log de pedidos
- `GET /api/messages`: Obtener log de mensajes

### Sistema de Monitoreo
- `GET /health`: Health check
- `GET /metrics`: M√©tricas actuales
- `WebSocket :3001`: Stream de m√©tricas en tiempo real

## üéØ Funcionalidades Principales

### 1. Flujo de Pedidos
1. Usuario env√≠a pedido desde web app
2. Bot recibe JSON del pedido
3. Solicita direcci√≥n de entrega
4. Pregunta m√©todo de pago
5. Para efectivo: solicita denominaci√≥n
6. Para transferencia: solicita comprobante
7. Confirma pedido completo
8. Notifica a admins
9. Registra en n8n/Google Sheets

### 2. Respuestas Inteligentes (Gemini)
- Consultas sobre men√∫
- Preguntas de horarios
- Info de promociones
- Contacto con humano

### 3. Panel de Administraci√≥n
- **Dise√±o moderno**: Tema oscuro con tarjetas y efectos hover
- **Layout responsive**: Grid de 2 columnas (desktop) y 1 columna (m√≥vil)
- **Iconograf√≠a profesional**: FontAwesome para mejor UX
- Editor de men√∫/configuraci√≥n
- Visualizaci√≥n de pedidos
- Logs de conversaciones
- M√©tricas en tiempo real
- **Header sticky**: Con logo, estado del sistema y botones de acci√≥n

### 4. Sistema de Alertas
- CPU > 80%
- Memoria > 85%
- Tiempo de respuesta > 5s
- Tasa de error > 5%
- Disco > 90%

## üîê Seguridad

### Validaciones
- Verificaci√≥n de tokens de WhatsApp
- Validaci√≥n de administradores
- Sanitizaci√≥n de inputs
- Rate limiting

### Datos Sensibles
- Tokens en variables de entorno
- No exponer claves en logs
- HTTPS obligatorio
- Pol√≠tica de privacidad cumplida

## üö® Manejo de Errores

### Estrategias
1. **Try-catch** en operaciones cr√≠ticas
2. **Timeout** en llamadas HTTP (5s)
3. **Retry logic** para Redis
4. **Fallback** a respuestas predefinidas
5. **Logging** detallado de errores

### Notificaciones
- Errores cr√≠ticos ‚Üí Admins v√≠a WhatsApp
- Alertas de sistema ‚Üí Telegram (opcional)
- Logs ‚Üí Consola y Redis

## üìà Optimizaciones

### Memoria (512MB)
```javascript
// L√≠mite de heap a 400MB
NODE_OPTIONS='--max-old-space-size=400'

// Garbage collection agresivo
setInterval(() => global.gc(), 300000)

// Threadpool reducido
UV_THREADPOOL_SIZE=2
```

### Rendimiento
- Conexiones persistentes (keep-alive)
- Cach√© de respuestas frecuentes
- Lazy loading de datos
- Compresi√≥n de responses

## üîÑ Workflows n8n

### Message Processor
1. **Webhook Entry Point**: Recibe mensajes
2. **Message Normalizer**: Estructura datos
3. **Enhanced Processor**: Procesa seg√∫n tipo
4. **Actions**:
   - Guardar en Google Sheets
   - Descargar y guardar im√°genes
   - Actualizar estado del cliente
   - Enviar respuestas autom√°ticas

### Automatizaciones
- Encuestas post-compra
- Recordatorios de pedidos
- An√°lisis de sentimiento
- Reportes autom√°ticos

## üß™ Testing

### Endpoints a Probar
```bash
# Health check
curl https://capibobbabot.onrender.com/

# Metrics
curl https://capibobbabot.onrender.com/metrics

# Dashboard
curl https://capibobbabot.onrender.com/dashboard

# Business data
curl https://capibobbabot.onrender.com/api/business-data
```

### Estados de Conversaci√≥n
- Nuevo usuario
- Pedido completo
- Cancelaci√≥n
- Error en pago
- Timeout de sesi√≥n

## üöÄ Deployment

### Pre-requisitos
1. Cuenta en Render.com
2. Redis Cloud configurado
3. n8n workflow activo
4. Variables de entorno configuradas

### Pasos
1. Push a GitHub
2. Conectar Render a repo
3. Configurar Build Command: `npm install`
4. Configurar Start Command: `npm start`
5. Agregar variables de entorno
6. Habilitar Web Service + Background Worker

### Post-deployment
1. Verificar health endpoint
2. Probar webhook de WhatsApp
3. Validar conexi√≥n Redis
4. Confirmar m√©tricas en dashboard

## üêõ Troubleshooting

### Bot no responde
1. Verificar webhook configurado en Meta
2. Revisar logs en Render
3. Confirmar conexi√≥n Redis
4. Validar token de WhatsApp

### M√©tricas no se actualizan
1. Verificar WebSocket en puerto 3001
2. Revisar firewall/CORS
3. Confirmar m√©tricas en Redis
4. Validar HealthChecker activo

### Errores de memoria
1. Revisar garbage collection
2. Verificar l√≠mite de heap
3. Analizar memory leaks
4. Reducir retenci√≥n de datos

### n8n no recibe datos
1. Validar URL del webhook
2. Confirmar formato de payload
3. Revisar logs de n8n
4. Verificar autenticaci√≥n

## üìö Comandos √ötiles

### Desarrollo
```bash
# Instalar dependencias
npm install

# Ejecutar localmente
npm start

# Ver logs en Render
render logs -s service-name

# Conectar a Redis local
docker run -d -p 6379:6379 redis
```

### Monitoreo
```bash
# Ver m√©tricas actuales
curl localhost:3000/metrics

# Health check
curl localhost:3000/health

# Limpiar Redis
redis-cli FLUSHALL
```

## üé® Personalizaci√≥n

### Modificar Men√∫
Editar `business_data.js` con:
- Categor√≠as de productos
- Precios
- Promociones
- Horarios
- Informaci√≥n de contacto

### Ajustar Flujos
Modificar en `chatbot.js`:
- Estados de conversaci√≥n
- Respuestas predefinidas
- Validaciones
- Notificaciones

### Customizar Dashboard
Actualizar en `/dashboard/`:
- **App.js**: Estructura principal con layout moderno
- **index.css**: Variables CSS para tema oscuro y responsive design
- **index.html**: Incluye FontAwesome CDN
- Componentes React individuales
- Gr√°ficos Chart.js
- Sistema de grid responsive

## üé® Dashboard Moderno (v2.0)

### Dise√±o Visual
- **Tema oscuro profesional**: Inspirado en el dashboard de monitoreo
- **Paleta de colores**: Variables CSS con esquema azul/gris oscuro
- **Tipograf√≠a**: Inter font family para mejor legibilidad
- **Efectos visuales**: Hover effects, sombras y transiciones suaves

### Layout y Estructura
```
Header Sticky
‚îú‚îÄ‚îÄ Logo + Estado del Sistema
‚îî‚îÄ‚îÄ Botones de Acci√≥n (Actualizar, Configuraci√≥n)

Grid Principal (2 columnas desktop, 1 m√≥vil)
‚îú‚îÄ‚îÄ Columna Izquierda (Componentes principales)
‚îÇ   ‚îú‚îÄ‚îÄ Modo Mantenimiento
‚îÇ   ‚îú‚îÄ‚îÄ Editor de Datos de Negocio
‚îÇ   ‚îú‚îÄ‚îÄ Visualizador de Pedidos
‚îÇ   ‚îî‚îÄ‚îÄ Dashboard de Encuestas
‚îî‚îÄ‚îÄ Columna Derecha (Actividad y herramientas)
    ‚îú‚îÄ‚îÄ Interfaz de Chat
    ‚îú‚îÄ‚îÄ Registro de Mensajes
    ‚îî‚îÄ‚îÄ Estado de Redis
```

### Componentes UI
- **Tarjetas**: Fondo oscuro con bordes y hover effects
- **Headers**: Con iconos FontAwesome y fondo diferenciado
- **Botones**: Styled con colores primarios/secundarios
- **Scrollbars**: Personalizados para mantener el tema

### Responsive Design
- **Desktop**: Grid 2fr 1fr (70% - 30%)
- **Tablet**: Grid 1fr (columna √∫nica)
- **Mobile**: Layout apilado con padding reducido
- **Breakpoints**: 1200px, 768px, 480px

### Iconograf√≠a
- **FontAwesome 6.4.0**: CDN integrado
- **Iconos tem√°ticos**: Robot, herramientas, gr√°ficos, chat, base de datos
- **Estados visuales**: Conectado (verde), desconectado (rojo), cargando (amarillo)

## üîÆ Roadmap

### Features Planeadas
- [ ] Multi-idioma
- [ ] Integraci√≥n con pagos online
- [ ] Sistema de cupones
- [ ] Programa de lealtad
- [ ] Chat grupal para equipos
- [ ] Analytics avanzados
- [ ] A/B testing
- [ ] Voice messages support
- [ ] Web widget para sitio web
- [ ] Seguimiento en tiempo real de pedidos
- [ ] Notificaciones push/SMS
- [ ] Sistema de feedback y rese√±as
- [ ] Gesti√≥n de inventario en tiempo real
- [ ] Encuestas post-entrega autom√°ticas
- [ ] QR codes para pagos inmediatos
- [ ] Ofertas personalizadas basadas en historial
- [ ] Chatbot para Telegram
- [ ] Instagram DM integration
- [ ] Facebook Messenger integration
- [ ] Sistema de quejas/reclamos

### Mejoras T√©cnicas
- [ ] Tests automatizados
- [ ] CI/CD pipeline
- [ ] Containerizaci√≥n (Docker)
- [ ] Kubernetes deployment
- [ ] Rate limiting avanzado
- [ ] Cach√© distribuido
- [ ] APM (Application Performance Monitoring)
- [ ] Alertas inteligentes con ML
- [ ] Logs estructurados con ELK stack
- [ ] Backup autom√°tico de Redis
- [ ] Replicaci√≥n de datos cr√≠ticos
- [ ] Plan de recuperaci√≥n ante desastres
- [ ] Detecci√≥n de spam/abuse
- [ ] Audit logs de acciones cr√≠ticas
- [ ] Compresi√≥n de im√°genes autom√°tica
- [ ] CDN para assets est√°ticos
- [ ] Predicci√≥n de demanda con IA
- [ ] Versionado de configuraciones

### Mejoras de Analytics y M√©tricas
- [ ] M√©tricas de conversi√≥n por producto
- [ ] An√°lisis de sentimiento de clientes
- [ ] Horas pico y tendencias
- [ ] Dashboard de insights de negocio
- [ ] M√©tricas de satisfacci√≥n del cliente
- [ ] Rating de productos
- [ ] Analytics de widget web
- [ ] A/B testing de interfaces

### Mejoras de Seguridad
- [ ] Rate limiting por usuario
- [ ] Validaci√≥n mejorada de inputs
- [ ] Backup y recuperaci√≥n autom√°tica
- [ ] Monitoreo de seguridad 24/7

## üìû Soporte

### Contacto
- GitHub: @FeyoMx
- Issues: GitHub Issues
- Docs: README.md

### Recursos
- [WhatsApp Cloud API Docs](https://developers.facebook.com/docs/whatsapp/cloud-api)
- [Google Gemini Docs](https://ai.google.dev/docs)
- [n8n Documentation](https://docs.n8n.io/)
- [Redis Documentation](https://redis.io/docs/)

## üìù Notas Importantes

### Para Claude Code
- Este proyecto usa **Redis** para estado persistente
- El bot requiere **webhooks activos** de WhatsApp
- Las **m√©tricas** se actualizan cada 5 segundos
- El **garbage collector** corre cada 5 minutos
- Los **backups** son autom√°ticos a las 3 AM

### Consideraciones
- **No incluir** archivo `.env` en commits
- **Actualizar** tokens regularmente
- **Monitorear** uso de recursos en Render
- **Revisar** logs diariamente
- **Mantener** business_data.js actualizado

### L√≠mites Conocidos
- Render free tier: 512MB RAM
- WhatsApp API: Rate limits por n√∫mero
- Redis: Expira estados en 24h
- Gemini: L√≠mites de requests/minuto

---

## üìã Historial de Cambios

### v2.2.2 (2025-09-29)
- üîß **Fix filtro de m√©tricas de negocio**: Corregido problema donde el selector de timeframe en el dashboard de monitoreo no funcionaba
  - **Frontend (`monitoring-client.js`)**:
    - Implementada funci√≥n `updateBusinessTimeframe()` que estaba vac√≠a
    - Agregado manejo del mensaje `business_metrics_response` del servidor
    - Implementadas funciones `updateBusinessMetricsWithTimeframe()` y `updateBusinessChart()`
    - Agregado indicador de carga visual durante solicitud de datos
  - **Backend (`websocket-server.js`)**:
    - Agregado caso `request_business_metrics` para manejar solicitudes de timeframe espec√≠fico
    - Implementado m√©todo `handleBusinessMetricsRequest()` y `getBusinessMetricsForTimeframe()`
    - Agregados m√©todos para obtener datos hist√≥ricos (`getHistoricalData()`, `getWeeklyData()`, `getDailyData()`)
    - Soporte completo para timeframes: 1h, 24h, 7d
  - **CSS (`monitoring.css`)**:
    - Agregados estilos para indicador de carga en selector de timeframe
    - Animaci√≥n de spinner y estados loading/disabled
- ‚úÖ **Funcionalidad completa**: Ahora se pueden ver m√©tricas filtradas por "√öltima semana" correctamente
- üìä **Gr√°ficos din√°micos**: El chart de m√©tricas de negocio se actualiza seg√∫n el timeframe seleccionado

### v2.2.1 (2025-09-29)
- üêõ **Fix cr√≠tico funci√≥n no definida**: Corregido ReferenceError `sendOrderCompletionToN8n is not defined` en `chatbot.js:1885`
  - Reemplazadas llamadas a `sendOrderCompletionToN8n` por `sendOrderCompletionToN8nEnhanced` (nombre correcto de la funci√≥n)
  - Afectaba el flujo de finalizaci√≥n de pedidos con comprobante de pago y efectivo
- üîß **Enhanced Message Normalizer**: Implementada l√≥gica para evitar clasificar mensajes del bot como `customer_inquiry`
  - Agregada condici√≥n `!normalizedBody.isFromBot` en la detecci√≥n de consultas de clientes
  - Previene clasificaci√≥n incorrecta de respuestas autom√°ticas del bot
- ‚úÖ **Estabilidad mejorada**: El bot ya no genera errores al procesar comprobantes de pago y denominaciones de efectivo

### v2.2.0 (2025-09-28)
- üöÄ **Sistema de procesamiento de mensajes mejorado**: Reestructuraci√≥n completa del manejo de mensajes de texto
- üéØ **Detecci√≥n inteligente de consultas**: Nuevos patrones para reconocer consultas sobre env√≠o, precios, horarios y pedidos
- üì¶ **Funciones especializadas**:
  - `handleDeliveryInquiry`: Respuestas espec√≠ficas sobre env√≠o y delivery
  - `handlePriceInquiry`: Informaci√≥n detallada de precios y promociones
  - `handleServiceStatusCheck`: Estado del servicio y horarios en tiempo real
  - `handleInitiateOrder`: Gu√≠a optimizada para iniciar pedidos
- ü§ñ **Gemini AI mejorado**: Prompt reestructurado con contexto de negocio m√°s robusto y verificaci√≥n de estado de mantenimiento
- üîß **Funciones auxiliares agregadas**:
  - `handleAccessCodeTextResponse`: Manejo de texto para c√≥digos de acceso
  - `handlePaymentMethodTextResponse`: Procesamiento de texto para m√©todos de pago
- üõ°Ô∏è **Manejo de errores robusto**: Sistema de fallback mejorado que previene bucles infinitos
- üìã **Sistema de comandos actualizado**: Mapeo optimizado de comandos exactos y patrones de palabras clave
- ‚ú® **Mejor UX**: Respuestas m√°s espec√≠ficas y contextuales antes de usar IA como respaldo

### v2.1.1 (2025-09-19)
- üîß **Fix flujo de ubicaci√≥n**: Corregido problema donde el bot terminaba el flujo cuando el usuario seleccionaba "dar ubicaci√≥n"
- üîß **Mejora manejo de errores**: Agregado try-catch en env√≠o de mensajes interactivos con fallback a texto simple
- üîß **Soporte texto y botones**: Permite responder tanto con botones como con texto en pregunta de c√≥digo de acceso
- üîß **Logs mejorados**: Agregados logs de debugging para rastrear el flujo de ubicaci√≥n
- üîß **Estado awaiting_access_code_info**: Agregado manejo completo para este estado en handleTextMessage

### v2.1.0 (2025-09-19)
- ‚úÖ **Dashboard UI Redesign**: Implementado tema oscuro moderno
- ‚úÖ **Layout responsive**: Grid 2-columnas con breakpoints m√≥viles
- ‚úÖ **FontAwesome integration**: Iconograf√≠a profesional
- ‚úÖ **CSS Variables**: Sistema de dise√±o escalable
- ‚úÖ **Card-based UI**: Componentes con efectos hover
- ‚úÖ **Build optimizado**: Compilaci√≥n exitosa sin errores

### v2.0.0 (Inicial)
- Sistema completo de bot con monitoreo
- Integraci√≥n n8n y Redis
- Dashboard b√°sico con Material-UI

---

**√öltima actualizaci√≥n**: 29 de Septiembre, 2025 - Fix filtro m√©tricas dashboard monitoreo v2.2.2
**Versi√≥n del proyecto**: 2.2.2
**Mantenedor**: @FeyoMx

### üìù Nota para futuras actualizaciones
Este archivo debe actualizarse con cada cambio significativo al proyecto, incluyendo:
- Nuevas funcionalidades
- Cambios de dise√±o/UI
- Modificaciones de arquitectura
- Actualizaciones de dependencias
- Correcciones importantes