"use strict";(self.webpackChunkdashboard=self.webpackChunkdashboard||[]).push([[83],{1083:(e,t,s)=>{s.r(t),s.d(t,{default:()=>ne});var a=s(5043),n=s(6446),r=s(1637),i=s(4194),o=s(5865),l=s(8483),c=s(1906),d=s(7392),x=s(8903),h=s(8625),p=s(5971),g=s(9722),j=s(2450),m=s(9379),A=s(2110),u=s(6494),f=s(3845),y=s(7912),v=s(3881),b=s(5678),S=s(3253),k=s(7260),C=s(6520),w=s(579);const E=e=>{let{title:t,value:s,percentage:a,icon:r,color:i,threshold:l}=e;const c=(()=>{if(!l)return i;const e=parseFloat(a);return"min"===l.type?e>=l.excellent?"#4caf50":e>=l.acceptable?"#ff9800":"#f44336":e<=l.excellent?"#4caf50":e<=l.acceptable?"#ff9800":"#f44336"})();return(0,w.jsx)(A.A,{sx:{height:"100%",background:"linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%)",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",transition:"transform 0.2s, box-shadow 0.2s","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 12px rgba(0,0,0,0.15)"}},children:(0,w.jsxs)(u.A,{children:[(0,w.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,w.jsx)(n.A,{sx:{backgroundColor:"".concat(c,"20"),borderRadius:"12px",p:1.5,display:"flex",mr:2},children:(0,w.jsx)(r,{sx:{color:c,fontSize:32}})}),(0,w.jsx)(o.A,{variant:"h6",component:"div",sx:{flexGrow:1,fontWeight:600},children:t})]}),(0,w.jsx)(o.A,{variant:"h3",component:"div",sx:{fontWeight:700,mb:1},children:s}),a&&(0,w.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,w.jsx)(f.A,{label:"".concat(a,"%"),size:"small",sx:{backgroundColor:c,color:"white",fontWeight:600}}),parseFloat(a)>50?(0,w.jsx)(y.A,{sx:{color:c,fontSize:20}}):(0,w.jsx)(v.A,{sx:{color:c,fontSize:20}})]})]})})};const D=function(e){let{stats:t}=e;if(!t||!t.stats)return(0,w.jsx)(n.A,{sx:{textAlign:"center",py:4},children:(0,w.jsx)(o.A,{variant:"body1",color:"text.secondary",children:"No hay datos disponibles"})});const{totalSent:s,delivered:a,read:r,reactions:i,deliveryRate:l,readRate:c,engagementRate:d}=t.stats,x=[{title:"Total Enviados",value:s.toLocaleString(),icon:b.A,color:"#2196f3"},{title:"Tasa de Entrega",value:a.toLocaleString(),percentage:l.toFixed(1),icon:S.A,color:"#4caf50",threshold:{type:"min",excellent:85,acceptable:75}},{title:"Tasa de Lectura",value:r.toLocaleString(),percentage:c.toFixed(1),icon:k.A,color:"#ff9800",threshold:{type:"min",excellent:30,acceptable:15}},{title:"Engagement",value:i.toLocaleString(),percentage:d.toFixed(1),icon:C.A,color:"#e91e63",threshold:{type:"min",excellent:5,acceptable:2}}];return(0,w.jsx)(n.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr",md:"repeat(4, 1fr)"},gap:3},children:x.map((e,t)=>(0,w.jsx)(E,(0,m.A)({},e),t))})};var I=s(4493),z=s(5721),W=s(681),F=s(8968),N=s(9814),O=s(8569),R=s(2502),L=s(9778),T=s(9232),B=s(5521),M=s(4057);const P=function(e){let{campaigns:t,selectedCampaignId:s,onSelectCampaign:r,loading:i}=e;return i?(0,w.jsx)(A.A,{children:(0,w.jsx)(u.A,{children:(0,w.jsx)(n.A,{sx:{textAlign:"center",py:3},children:(0,w.jsx)(o.A,{variant:"body2",color:"text.secondary",children:"Cargando campanas..."})})})}):t&&0!==t.length?(0,w.jsx)(A.A,{children:(0,w.jsxs)(u.A,{sx:{p:0},children:[(0,w.jsx)(n.A,{sx:{p:2,pb:1},children:(0,w.jsxs)(o.A,{variant:"h6",component:"div",sx:{fontWeight:600},children:["Campanas (",t.length,")"]})}),(0,w.jsx)(I.A,{}),(0,w.jsx)(z.A,{sx:{py:0},children:t.map((e,i)=>(0,w.jsxs)(a.Fragment,{children:[(0,w.jsx)(W.Ay,{disablePadding:!0,children:(0,w.jsxs)(F.A,{selected:s===e.id,onClick:()=>r(e.id),sx:{py:2,"&.Mui-selected":{backgroundColor:"primary.light","&:hover":{backgroundColor:"primary.light"}}},children:[(0,w.jsx)(N.A,{children:e.active?(0,w.jsx)(L.A,{color:"success"}):(0,w.jsx)(T.A,{color:"disabled"})}),(0,w.jsx)(O.A,{primary:(0,w.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,w.jsx)(o.A,{variant:"subtitle1",component:"span",sx:{fontWeight:600},children:e.name}),e.active?(0,w.jsx)(f.A,{label:"Activa",size:"small",color:"success"}):(0,w.jsx)(f.A,{label:"Pausada",size:"small",color:"default"})]}),secondary:(0,w.jsxs)(n.A,{sx:{mt:.5},children:[(0,w.jsx)(o.A,{variant:"caption",display:"block",color:"text.secondary",children:e.description}),(0,w.jsxs)(o.A,{variant:"caption",display:"block",color:"text.secondary",children:["Creada: ",(0,B.GP)(new Date(e.created),"d 'de' MMMM, yyyy",{locale:M.es})]}),e.stats&&(0,w.jsxs)(n.A,{sx:{display:"flex",gap:2,mt:1},children:[(0,w.jsxs)(o.A,{variant:"caption",sx:{color:"primary.main"},children:[e.stats.totalSent," enviados"]}),(0,w.jsxs)(o.A,{variant:"caption",sx:{color:"success.main"},children:[e.stats.delivered," entregados"]}),(0,w.jsxs)(o.A,{variant:"caption",sx:{color:"info.main"},children:[e.stats.read," leidos"]})]})]})})]})}),i<t.length-1&&(0,w.jsx)(I.A,{})]},e.id))})]})}):(0,w.jsx)(A.A,{children:(0,w.jsx)(u.A,{children:(0,w.jsxs)(n.A,{sx:{textAlign:"center",py:3},children:[(0,w.jsx)(R.A,{sx:{fontSize:48,color:"text.secondary",mb:2}}),(0,w.jsx)(o.A,{variant:"body1",color:"text.secondary",children:"No hay campanas disponibles"})]})})})};var K=s(1180),_=s(7554),G=s(7734),H=s(2185),J=s(6026),V=s(379),Y=s(95),q=s(3199);const Q=e=>{let{active:t,payload:s,label:a}=e;return t&&s&&s.length?(0,w.jsxs)(n.A,{sx:{backgroundColor:"white",border:"1px solid #ccc",borderRadius:1,p:1.5,boxShadow:"0 2px 8px rgba(0,0,0,0.15)"},children:[(0,w.jsx)(o.A,{variant:"caption",sx:{fontWeight:600,display:"block",mb:1},children:a}),s.map((e,t)=>(0,w.jsxs)(o.A,{variant:"caption",sx:{color:e.color,display:"block"},children:[e.name,": ",e.value]},t))]}):null};const U=function(e){let{messages:t}=e;if(!t||0===t.length)return(0,w.jsx)(A.A,{children:(0,w.jsxs)(u.A,{children:[(0,w.jsx)(o.A,{variant:"h6",gutterBottom:!0,children:"Evolucion Temporal"}),(0,w.jsx)(n.A,{sx:{textAlign:"center",py:4},children:(0,w.jsx)(o.A,{variant:"body2",color:"text.secondary",children:"No hay datos suficientes para mostrar el grafico"})})]})});const s=t.reduce((e,t)=>{const s=t.timestamps.sent,a=(0,B.GP)(new Date(s),"HH:00",{locale:M.es});return e[a]||(e[a]={hour:a,enviados:0,entregados:0,leidos:0}),e[a].enviados+=1,["delivered","read"].includes(t.status)&&(e[a].entregados+=1),"read"===t.status&&(e[a].leidos+=1),e},{}),a=Object.values(s).sort((e,t)=>e.hour.localeCompare(t.hour));return(0,w.jsx)(A.A,{children:(0,w.jsxs)(u.A,{children:[(0,w.jsx)(o.A,{variant:"h6",gutterBottom:!0,sx:{fontWeight:600},children:"Evolucion Temporal"}),(0,w.jsx)(n.A,{sx:{width:"100%",height:350,mt:2},children:(0,w.jsx)(K.u,{children:(0,w.jsxs)(_.b,{data:a,margin:{top:5,right:30,left:20,bottom:5},children:[(0,w.jsx)(G.d,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),(0,w.jsx)(H.W,{dataKey:"hour",stroke:"#666",style:{fontSize:"12px"}}),(0,w.jsx)(J.h,{stroke:"#666",style:{fontSize:"12px"}}),(0,w.jsx)(V.m,{content:(0,w.jsx)(Q,{})}),(0,w.jsx)(Y.s,{wrapperStyle:{fontSize:"14px"},iconType:"line"}),(0,w.jsx)(q.N,{type:"monotone",dataKey:"enviados",stroke:"#2196f3",strokeWidth:2,dot:{r:4},activeDot:{r:6},name:"Enviados"}),(0,w.jsx)(q.N,{type:"monotone",dataKey:"entregados",stroke:"#4caf50",strokeWidth:2,dot:{r:4},activeDot:{r:6},name:"Entregados"}),(0,w.jsx)(q.N,{type:"monotone",dataKey:"leidos",stroke:"#ff9800",strokeWidth:2,dot:{r:4},activeDot:{r:6},name:"Leidos"})]})})})]})})};var X=s(6992),Z=s(4152),$=s(7869);const ee={sent:"#00bcd4",delivered:"#4caf50",read:"#2196f3",failed:"#f44336"},te=e=>{let{active:t,payload:s}=e;if(t&&s&&s.length){const e=s[0];return(0,w.jsxs)(n.A,{sx:{backgroundColor:"white",border:"1px solid #ccc",borderRadius:1,p:1.5,boxShadow:"0 2px 8px rgba(0,0,0,0.15)"},children:[(0,w.jsx)(o.A,{variant:"caption",sx:{fontWeight:600,display:"block"},children:e.name}),(0,w.jsxs)(o.A,{variant:"caption",sx:{display:"block"},children:["Cantidad: ",e.value]}),(0,w.jsxs)(o.A,{variant:"caption",sx:{display:"block"},children:["Porcentaje: ",e.payload.percentage,"%"]})]})}return null},se=e=>"".concat(e.percentage,"%");const ae=function(e){let{stats:t}=e;if(!t||!t.messages||!t.messages.byStatus)return(0,w.jsx)(A.A,{children:(0,w.jsxs)(u.A,{children:[(0,w.jsx)(o.A,{variant:"h6",gutterBottom:!0,children:"Distribucion de Estados"}),(0,w.jsx)(n.A,{sx:{textAlign:"center",py:4},children:(0,w.jsx)(o.A,{variant:"body2",color:"text.secondary",children:"No hay datos disponibles"})})]})});const{byStatus:s}=t.messages,a=Object.values(s).reduce((e,t)=>e+t,0),r=Object.entries(s).filter(e=>{let[t,s]=e;return s>0}).map(e=>{let[t,s]=e;return{name:"sent"===t?"En transito":"delivered"===t?"Entregados":"read"===t?"Leidos":"Fallidos",value:s,percentage:(s/a*100).toFixed(1),status:t}});return 0===r.length?(0,w.jsx)(A.A,{children:(0,w.jsxs)(u.A,{children:[(0,w.jsx)(o.A,{variant:"h6",gutterBottom:!0,children:"Distribucion de Estados"}),(0,w.jsx)(n.A,{sx:{textAlign:"center",py:4},children:(0,w.jsx)(o.A,{variant:"body2",color:"text.secondary",children:"No hay mensajes para mostrar"})})]})}):(0,w.jsx)(A.A,{children:(0,w.jsxs)(u.A,{children:[(0,w.jsx)(o.A,{variant:"h6",gutterBottom:!0,sx:{fontWeight:600},children:"Distribucion de Estados"}),(0,w.jsx)(n.A,{sx:{width:"100%",height:350,mt:2},children:(0,w.jsx)(K.u,{children:(0,w.jsxs)(X.r,{children:[(0,w.jsx)(Z.F,{data:r,cx:"50%",cy:"50%",labelLine:!1,label:se,outerRadius:100,fill:"#8884d8",dataKey:"value",children:r.map((e,t)=>(0,w.jsx)($.f,{fill:ee[e.status]},"cell-".concat(t)))}),(0,w.jsx)(V.m,{content:(0,w.jsx)(te,{})}),(0,w.jsx)(Y.s,{verticalAlign:"bottom",height:36,wrapperStyle:{fontSize:"14px"}})]})})}),(0,w.jsx)(n.A,{sx:{mt:2,display:"grid",gridTemplateColumns:"1fr 1fr",gap:2},children:r.map(e=>(0,w.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,w.jsx)(n.A,{sx:{width:12,height:12,borderRadius:"50%",backgroundColor:ee[e.status]}}),(0,w.jsxs)(o.A,{variant:"body2",children:[(0,w.jsxs)("strong",{children:[e.name,":"]})," ",e.value," (",e.percentage,"%)"]})]},e.status))})]})})};const ne=function(){const[e,t]=(0,a.useState)([]),[s,m]=(0,a.useState)(null),[A,u]=(0,a.useState)(null),[f,y]=(0,a.useState)([]),[v,b]=(0,a.useState)(!0),[S,k]=(0,a.useState)(null),[C,E]=(0,a.useState)(!0),I=(0,a.useCallback)(async()=>{try{const e=await g.A.get("/api/marketing/campaigns");if(e.data.success){const a=e.data.campaigns;if(t(a),!s&&a.length>0){const e=a.find(e=>e.active)||a[0];m(e.id)}}}catch(e){console.error("Error loading campaigns:",e),k("Error al cargar las campanas")}finally{b(!1)}},[s]),z=(0,a.useCallback)(async()=>{if(s)try{const[e,t]=await Promise.all([g.A.get("/api/marketing/campaign/".concat(s,"/stats")),g.A.get("/api/marketing/campaign/".concat(s,"/messages"))]);e.data.success&&u(e.data),t.data.success&&y(t.data.messages||[])}catch(e){console.error("Error loading campaign stats:",e),k("Error al cargar las estadisticas de la campana")}},[s]);return(0,a.useEffect)(()=>{I()},[I]),(0,a.useEffect)(()=>{s&&z()},[s,z]),(0,a.useEffect)(()=>{if(!C)return;const e=setInterval(()=>{I(),s&&z()},3e4);return()=>clearInterval(e)},[C,s,I,z]),v&&0===e.length?(0,w.jsx)(n.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400},children:(0,w.jsx)(r.A,{})}):S&&0===e.length?(0,w.jsx)(i.A,{severity:"error",sx:{mb:2},children:S}):(0,w.jsxs)(n.A,{children:[(0,w.jsxs)(n.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,w.jsx)(o.A,{variant:"h5",component:"h2",sx:{fontWeight:600},children:"Dashboard de Marketing"}),(0,w.jsxs)(n.A,{sx:{display:"flex",gap:1},children:[(0,w.jsx)(l.A,{title:C?"Auto-refresh activado":"Auto-refresh desactivado",children:(0,w.jsxs)(c.A,{variant:C?"contained":"outlined",size:"small",onClick:()=>E(!C),children:["Auto-refresh: ",C?"ON":"OFF"]})}),(0,w.jsx)(l.A,{title:"Actualizar ahora",children:(0,w.jsx)(d.A,{onClick:()=>{b(!0),I(),s&&z(),b(!1)},color:"primary",children:(0,w.jsx)(h.A,{})})}),(0,w.jsx)(l.A,{title:"Exportar a JSON",children:(0,w.jsx)(d.A,{onClick:()=>{const t={campaign:e.find(e=>e.id===s),stats:A,messages:f,exportedAt:(new Date).toISOString()},a=new Blob([JSON.stringify(t,null,2)],{type:"application/json"});(0,j.saveAs)(a,"campana_".concat(s,"_").concat(Date.now(),".json"))},color:"primary",disabled:!s,children:(0,w.jsx)(p.A,{})})}),(0,w.jsx)(l.A,{title:"Exportar a CSV",children:(0,w.jsx)(c.A,{variant:"outlined",size:"small",onClick:()=>{if(0===f.length)return;const e=[["Message ID","Recipient","Status","Sent","Delivered","Read"],...f.map(e=>[e.messageId,e.recipient,e.status,e.timestamps.sent?new Date(e.timestamps.sent).toISOString():"",e.timestamps.delivered?new Date(e.timestamps.delivered).toISOString():"",e.timestamps.read?new Date(e.timestamps.read).toISOString():""])].map(e=>e.join(",")).join("\n"),t=new Blob([e],{type:"text/csv;charset=utf-8;"});(0,j.saveAs)(t,"mensajes_".concat(s,"_").concat(Date.now(),".csv"))},disabled:!s||0===f.length,startIcon:(0,w.jsx)(p.A,{}),children:"CSV"})})]})]}),(0,w.jsxs)(x.Ay,{container:!0,spacing:3,children:[(0,w.jsx)(x.Ay,{item:!0,xs:12,md:4,children:(0,w.jsx)(P,{campaigns:e,selectedCampaignId:s,onSelectCampaign:m,loading:v})}),(0,w.jsx)(x.Ay,{item:!0,xs:12,md:8,children:s&&A?(0,w.jsxs)(n.A,{sx:{display:"flex",flexDirection:"column",gap:3},children:[(0,w.jsx)(D,{stats:A}),(0,w.jsxs)(x.Ay,{container:!0,spacing:3,children:[(0,w.jsx)(x.Ay,{item:!0,xs:12,lg:6,children:(0,w.jsx)(ae,{stats:A})}),(0,w.jsx)(x.Ay,{item:!0,xs:12,lg:6,children:(0,w.jsx)(U,{messages:f})})]})]}):(0,w.jsx)(n.A,{sx:{textAlign:"center",py:8},children:(0,w.jsx)(o.A,{variant:"h6",color:"text.secondary",children:"Selecciona una campana para ver sus estadisticas"})})})]})]})}}}]);
//# sourceMappingURL=83.9c4b5946.chunk.js.map